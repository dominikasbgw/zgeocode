<%@page language="abap"%>                                                                                                                                                                                                                                      
<!DOCTYPE html PUBLIC                                                                                                                                                                                                                                          
    "-//W3C//DTD XHTML 1.0 Strict//EN"                                                                                                                                                                                                                         
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">                                                                                                                                                                                                       
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">                                                                                                                                                                                            
    <head>                                                                                                                                                                                                                                                     
        <title>GPS Testing</title>                                                                                                                                                                                                                             
    </head>                                                                                                                                                                                                                                                    
    <body>                                                                                                                                                                                                                                                     
    <%                                                                                                                                                                                                                                                         
    DATA: bpdetail like line of bpdetails.                                                                                                                                                                                                                     
    if bpdetails is initial AND bp is INITIAL. %>                                                                                                                                                                                                              
        <script type="text/javascript">                                                                                                                                                                                                                        
var modeCellsite   = 0;                                                                                                                                                                                                                                        
var modeAssisted   = 1;                                                                                                                                                                                                                                        
var modeAutonomous = 2;                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
function locationChanged()                                                                                                                                                                                                                                     
{                                                                                                                                                                                                                                                              
    lat.value = blackberry.location.latitude;                                                                                                                                                                                                                  
    lon.value = blackberry.location.longitude;                                                                                                                                                                                                                 
    return true;                                                                                                                                                                                                                                               
}                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
function getLocation() {                                                                                                                                                                                                                                       
  if ( window.blackberry && blackberry.location.GPSSupported ) {                                                                                                                                                                                               
      var isUpdated = false;                                                                                                                                                                                                                                   
      var theCount = 0;                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      alert("Please wait until the location is detected.");                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
      blackberry.location.onLocationUpdate("locationChanged()");                                                                                                                                                                                               
      blackberry.location.setAidMode(modeAutonomous);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
      while ( theCount++ < 10 && !isUpdated )                                                                                                                                                                                                                  
          isUpdated = blackberry.location.refreshLocation();                                                                                                                                                                                                   
  } else if(navigator.geolocation) {                                                                                                                                                                                                                           
    navigator.geolocation.getCurrentPosition(function(position) {                                                                                                                                                                                              
      /*                                                                                                                                                                                                                                                       
      alert('Your lat-long is: ' + position.coords.latitude + ' / ' + position.coords.longitude);                                                                                                                                                              
      alert('You live in ' + position.address.city + ', ' + position.address.region)                                                                                                                                                                           
      */                                                                                                                                                                                                                                                       
      document.form.lat.value = position.coords.latitude;                                                                                                                                                                                                      
      document.form.lon.value = position.coords.longitude;                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
  } else {                                                                                                                                                                                                                                                     
      document.write("Location tracking is not supported");                                                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
}                                                                                                                                                                                                                                                              
getLocation();                                                                                                                                                                                                                                                 
        </script>                                                                                                                                                                                                                                              
    <p>This application will search for business partners surrounding your                                                                                                                                                                                     
    current location in the specified distance. Please wait until the                                                                                                                                                                                          
    latidude and longitude is filled.</p><%                                                                                                                                                                                                                    
    endif.                                                                                                                                                                                                                                                     
    if bpdetails is INITIAL. %>                                                                                                                                                                                                                                
    <form action="default.htm" name="form" method="post">                                                                                                                                                                                                      
      <table>                                                                                                                                                                                                                                                  
        <tr>                                                                                                                                                                                                                                                   
          <th>Latitude:</th>                                                                                                                                                                                                                                   
          <td><input type="text" id="lat" name="lat" value="<%= geodata-latitude  %>" /></td>                                                                                                                                                                  
        </tr>                                                                                                                                                                                                                                                  
        <tr>                                                                                                                                                                                                                                                   
          <th>Longitude:</th>                                                                                                                                                                                                                                  
          <td><input type="text" id="lon" name="lon" value="<%= geodata-longitude %>" /></td>                                                                                                                                                                  
        </tr>                                                                                                                                                                                                                                                  
        <tr>                                                                                                                                                                                                                                                   
          <th>Distance:</th>                                                                                                                                                                                                                                   
          <td><input type="text" id="dist" name="dist" value="20" /> km</td>                                                                                                                                                                                   
        </tr>                                                                                                                                                                                                                                                  
      <table>                                                                                                                                                                                                                                                  
      <input type="hidden" name="OnInputProcessing(OK)" value="OK">                                                                                                                                                                                            
      <input type="submit" value=" Submit " />                                                                                                                                                                                                                 
      <button onClick="getLocation();">Get My Location</button>                                                                                                                                                                                                
    </form><%                                                                                                                                                                                                                                                  
    else. %>                                                                                                                                                                                                                                                   
      <table>                                                                                                                                                                                                                                                  
        <tr>                                                                                                                                                                                                                                                   
          <th>Name</th>                                                                                                                                                                                                                                        
          <th>Address</th>                                                                                                                                                                                                                                     
        </tr>                                                                                                                                                                                                                                                  
        <%                                                                                                                                                                                                                                                     
        loop at bpdetails into bpdetail. %>                                                                                                                                                                                                                    
        <tr>                                                                                                                                                                                                                                                   
          <td><a href="map.xloc?bp=<%= bpdetail-partner %>"><%= bpdetail-name %></a></td>                                                                                                                                                                      
          <td><%= bpdetail-location %></td>                                                                                                                                                                                                                    
          <td><a href="../ZGEOCODE_OSM/default.htm?bp=<%= bpdetail-partner %>">Display on Map</a></td>                                                                                                                                                         
        </tr>                                                                                                                                                                                                                                                  
        <%                                                                                                                                                                                                                                                     
        endloop. %>                                                                                                                                                                                                                                            
      <%                                                                                                                                                                                                                                                       
    endif.                                                                                                                                                                                                                                                     
    %>                                                                                                                                                                                                                                                         
    </body>                                                                                                                                                                                                                                                    
</html>                                                                                                                                                                                                                                                        